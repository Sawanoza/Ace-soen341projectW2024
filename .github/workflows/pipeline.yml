name: CI/CD Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test:
    runs-on: ubuntu-latest

    env:
      DB_HOST: localhost
      DB_USER: root
      DB_PASSWORD: root


    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Setup MySQL
  # You may pin to the exact commit or the version.
  # uses: mirromutth/mysql-action@de1fba8b3f90ce8db80f663a7043be3cf3231248
        uses: mirromutth/mysql-action@v1.1
        with:
          # The port of host
          host port: 3306 # optional, default is 3306
          # The port of container
          container port: 3306 # optional, default is 3306
          # MYSQL_ROOT_PASSWORD - root superuser password
          mysql root password: root # optional, default is 
          # MYSQL_USER - create the specified user with superuser power for created database
          mysql user: root # optional, default is 
          # MYSQL_PASSWORD - specified superuser password which user is power for created database
          mysql password: root # optional, default is 

      - name: Set executable permission
        run: chmod +x node_modules/.bin/jest
        
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Run Jest with --runInBand --detectOpenHandles --forceExit
        run: npm test

# Additional features (potentially added)
# Linting
# Code coverage tools to ensure that a certain percentage of code is covered by tests
# Integration tests to validate interactions between different parts of the system
# Building and deploying the application?
